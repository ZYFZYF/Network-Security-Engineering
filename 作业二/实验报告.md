#  GFW使用技术调查

TODO

# 被墙域名测试

- 从网上下载得到100万个最常用的域名，因速度原因选择了最前面的5000个进行测试。运行fping.py进行批量ping测试，并将结果输出到results.txt中。结果成功解析域名4668个，可ping通2912个，可知剩余1756个网站被墙。

# 无污染DNS服务器搭建

- 我们采用的是老师课上介绍的方法的简化版：
~~~
	因为DNS劫持导致的假的reply通常会以极快的速度返回并被接受，因此我们做法为发出请求后端口保持一段时间（程序中写死为固定值），将接收到的最后一个reply认为是正确的结果并且发回给请求方。
~~~

- 具体实现中，我们使用了dnslib库来发DNS请求包和解析DNS回复包，使用dnspython库来调用正常的dns服务来对获取的域名到ip的映射进行对比，结果写在了domains2ips.csv中。
- 最后我们用两台电脑做了实验，运行我们的dns服务器并且监听53端口，同时用dig发起其他域名的请求，对收到的DNS请求包转发给8.8.8.8的53端口并且用1秒内的最后一个返回结果作为真正的返回结果返回给请求方。实验结果如下：
  - 未开启服务时请求解析google.com得到结果![dig_1](dig_1.png)
  - 调用whois查询ip所属得到结果如图，可知其并不是google真正的ip![whois_1](whois_1.png)
  - 本机开启dns_server.py服务后，再次用dig请求对google.com域名进行解析，得到![dig_2](dig_2.png)
  - 再次调用whois查询得到结果，可知这确实是google.com真正的ip之一![whois_2](whois_2.png)
  - 可见DNS服务器获得了正确的无污染的结果